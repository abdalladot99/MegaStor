@model AllProductAndFultterViewModel


<!-- SECTION -->
	<div class="section">
		<!-- container -->
		<div class="container">
			<!-- row -->
			<div class="row">

 
			<div id="aside" class="col-md-3">

				<form id="filterForm" asp-action="Index" asp-controller="Search" method="get">

					<!-- Categories -->
					<div class="aside">
						<h3 class="aside-title">Categories</h3>
						<div class="checkbox-filter">
							@foreach (var item in Model.SubCategories)
							{
								<div class="input-checkbox">
 									<input @(Model.categoryIds != null && Model.categoryIds.Contains(item.SubCategoryId) ? "checked" : " ") 
									       type="checkbox" 
										   name="categoryIds"
										   value="@item.SubCategoryId"
										   id="category-@item.SubCategoryId" /> 

									<label for="category-@item.SubCategoryId">
										<span></span>
										@item.CategoryName
										<small>(@item.Products.Count)</small>
									</label>
								</div>
							}
						</div>
					</div>

					<!-- Price -->
					<div class="aside">
						<h3 class="aside-title">Price</h3>
						<div class="price-filter">
							<div class="input-number price-min">
 								<input id="price-min" name="minPrice" value="@Model.minPrice" type="number" placeholder="Min Price">
							</div>
							<span>-</span>
							<div class="input-number price-max">
 								<input id="price-max" name="maxPrice" value="@Model.maxPrice" type="number" placeholder="Max Price">
							</div>
						</div>
					</div>

					<input type="hidden" name="query" value="@Model.query" />
					@for (int i = 0; i > Model.categoryIds.Count;i++)
					{
						<input type="hidden" name="categoryIds[i]" value="@Model.categoryIds[i]" />
					}
					<input type="hidden" name="page" value="@Model.maxPrice" />
					<input type="hidden" name="maxPrice" value="@Model.minPrice" />
					<input type="hidden" name="minPrice" value="@Model.page" />

			</form>
			</div> 
			<script>
				// لو اتغير أي اختيار أو السعر يتبعت الفورم تلقائي
				document.querySelectorAll('#filterForm input').forEach(input => {
					input.addEventListener('change', () => {
						document.getElementById('filterForm').submit();
					});
				});
			</script>

				<!-- STORE -->
				<div id="store" class="col-md-9">
					<!-- store top filter -->
					<div class="store-filter clearfix">
						<div class="store-sort">
							<label>
								Sort By:
								<select class="input-select">
									<option value="0">Popular</option>
 								</select>
							</label>
							
							<label>
								Show:
								<select class="input-select">
									<option value="0">12</option>
 								</select>
						</label>

						<label class="ms-5   border-dark">
							@ViewBag.counter &emsp;  products
						</label>

						</div>
						<ul class="store-grid">
							<li class="active"><i class="fa fa-th"></i></li>
							<li><a href="#"><i class="fa fa-th-list"></i></a></li>
						</ul>
					</div>
					<!-- /store top filter -->
					<!-- store products -->
					@if (!Model.Products.Any())
					{
						<h1>Not fount product !!</h1>
					}
					else
					{


						<div class="row">


						@foreach (var item in Model.Products)
						{
							<div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-4">
								<div class="product">
									<div class="product-img" style="max-height: 230px; min-height: 230px; height: auto;">
										<img src="~/img/@item.ImageUrl"
											 style="width: 100%; height: 230px; object-fit: contain;"
											 alt="">

										<div class="product-label">
											<span class="sale">-@item.discount%</span>
 										</div>
									</div>
									<div class="product-body">
										<p class="product-category">@item.SubCategory.CategoryName</p>
										<h3 class="product-name"><a href="#">@item.Name</a></h3>
										@if (item.DiscountPrice != item.Price)
										{
											<h4 class="product-price">$@item.DiscountPrice <del class="product-old-price">$@item.Price</del></h4>
										}
										else
										{
											<h4 class="product-price">$@item.Price</h4>
										}
										<div class="product-rating">
											@{
												double avgRating = item.AverageRating;
												int fullStars = (int)avgRating;
												bool halfStar = avgRating - fullStars >= 0.5;
												int emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
											}
											@for (int i = 0; i < fullStars; i++)
											{
												<i class="fa fa-star"></i>
											}
											@if (halfStar)
											{
												<i class="fa fa-star-half-o"></i>
											}
											@for (int i = 0; i < emptyStars; i++)
											{
												<i class="fa fa-star-o"></i>
											}
										</div>
										<div class="product-btns">
											<form asp-controller="Wishlists" asp-action="AddWishList" method="post" style="display:inline;">
												@Html.AntiForgeryToken()
												<input type="hidden" name="id" value="@item.Id" />
												<button class="add-to-wishlist" type="submit" style="all: unset; cursor: pointer;">
													<i class="fa fa-heart-o"></i>
												</button>
											</form>
											<button class="add-to-compare"><i class="fa fa-exchange"></i></button>
											<button class="quick-view">
												<a asp-controller="Product" asp-action="Details" asp-route-id="@item.Id">
													<i class="fa fa-eye"></i>
												</a>
											</button>
										</div>
									</div>
									<div class="add-to-cart">
										<form asp-action="AddToCart" asp-controller="Cart" method="post">
											<input type="hidden" name="id" value="@item.Id" />
											<button type="submit" class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
										</form>
									</div>
								</div>
							</div>

						}
						<!-- /store products -->
					</div>
				}

				<!-- /STORE -->
			</div>
			<div class="store-filter clearfix">
				@{
					var routeValues = new Dictionary<string, string>();

					routeValues["categoryIds"] = string.Join(",", Model.categoryIds ?? new List<string>());
					routeValues["minPrice"] = Model.minPrice?.ToString() ?? "";
					routeValues["maxPrice"] = Model.maxPrice?.ToString() ?? "";
					routeValues["query"] = Model.query?.ToString() ?? ""; 
 					  
				}
					
				
				   
 				<ul class="store-pagination">
					<li class="@(ViewBag.pagination == 1 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="1">1</a></li>
					<li class="@(ViewBag.pagination == 2 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="2">2</a></li>
					<li class="@(ViewBag.pagination == 3 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="3">3</a></li>
					<li class="@(ViewBag.pagination == 4 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="4">4</a></li>
					<li class="@(ViewBag.pagination == 5 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="5">5</a></li>
					<li class="@(ViewBag.pagination == 6 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="6">6</a></li>
					<li class="@(ViewBag.pagination == 7 ? "active" : " ")"><a asp-controller="Search" asp-action="Index" asp-all-route-data="routeValues" asp-route-page="7">7</a></li>
					<li><a href="#"><i class="fa fa-angle-right"></i></a></li>
				</ul>
			</div>
			</div>
			<!-- /row -->
		</div>
		<!-- /container -->
	</div>
	<!-- /SECTION -->
 
